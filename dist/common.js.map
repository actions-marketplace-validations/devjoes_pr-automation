{"version":3,"sources":["../src/common.js"],"names":["nowPlusSecs","secs","date","Date","setSeconds","getSeconds","toDateString","toTimeString","updatedInTheLastSecs","p","getTime","updated_at","hasLabel","label","labels","filter","l","name","length","describePr","pr","number","title","branchNameFromRef","ref","toLowerCase","split","slice","getLatestClosingCommentAgeSecs","client","context","args","issueNumber","comments","issues","listComments","repo","issue_number","latestCommentDate","data","c","body","indexOf","closingSoonComment","replace","reduce","latest","i","created","created_at","undefined","deletePrBranch","logger","head","info","git","deleteRef"],"mappings":";;;;;;;AAAO,MAAMA,WAAW,GAAGC,IAAI,IAAI;AACjC,QAAMC,IAAI,GAAG,IAAIC,IAAJ,EAAb;AACAD,EAAAA,IAAI,CAACE,UAAL,CAAgBF,IAAI,CAACG,UAAL,KAAoBJ,IAApC;AACA,SAAOC,IAAI,CAACI,YAAL,KAAsB,GAAtB,GAA4BJ,IAAI,CAACK,YAAL,EAAnC;AACD,CAJM;;;;AAMA,MAAMC,oBAAoB,GAAG,CAACC,CAAD,EAAIR,IAAJ,KAClC,CAAC,IAAIE,IAAJ,GAAWO,OAAX,KAAuB,IAAIP,IAAJ,CAASM,CAAC,CAACE,UAAX,EAAuBD,OAAvB,EAAxB,IAA4D,IAA5D,GAAmET,IAD9D;;;;AAGA,MAAMW,QAAQ,GAAG,CAACH,CAAD,EAAII,KAAJ,KAAcA,KAAK,KAAK,GAAV,IAAiBJ,CAAC,CAACK,MAAF,CAASC,MAAT,CAAgBC,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWJ,KAAhC,EAAuCK,MAAvC,GAAgD,CAAhG;;;;AAEA,MAAMC,UAAU,GAAGC,EAAE,IAAK,OAAMA,EAAE,CAACC,MAAO,KAAID,EAAE,CAACE,KAAM,GAAvD;;;;AAEA,MAAMC,iBAAiB,GAAGC,GAAG,IAAIA,GAAG,CAACC,WAAJ,GAAkBC,KAAlB,CAAwB,KAAxB,EAA+BC,KAA/B,CAAqC,CAAC,CAAtC,EAAyC,CAAzC,CAAjC;;;;AAEA,MAAMC,8BAA8B,GAAG,OAAO;AAAEC,EAAAA,MAAF;AAAUC,EAAAA,OAAV;AAAmBC,EAAAA;AAAnB,CAAP,EAAkCC,WAAlC,KAAkD;AAC9F,QAAMC,QAAQ,GAAG,MAAMJ,MAAM,CAACK,MAAP,CAAcC,YAAd,CAA2B,EAChD,GAAGL,OAAO,CAACM,IADqC;AAEhDC,IAAAA,YAAY,EAAEL;AAFkC,GAA3B,CAAvB;AAIA,QAAMM,iBAAiB,GAAGL,QAAQ,CAACM,IAAT,CACvBxB,MADuB,CAChByB,CAAC,IAAIA,CAAC,CAACC,IAAF,CAAOC,OAAP,CAAeX,IAAI,CAACY,kBAAL,CAAwBC,OAAxB,CAAgC,MAAhC,EAAwC,EAAxC,CAAf,MAAgE,CADrD,EAEvBC,MAFuB,CAEhB,CAACC,MAAD,EAASC,CAAT,KAAe;AACrB,UAAMC,OAAO,GAAG,IAAI7C,IAAJ,CAAS4C,CAAC,CAACE,UAAX,CAAhB;;AACA,QAAI,CAACH,MAAD,IAAWE,OAAO,GAAGF,MAAzB,EAAiC;AAC/B,aAAOE,OAAP;AACD;;AACD,WAAOF,MAAP;AACD,GARuB,EAQrBI,SARqB,CAA1B;AAUA,SAAOZ,iBAAiB,GAAG,CAAC,IAAInC,IAAJ,GAAWO,OAAX,KAAuB4B,iBAAiB,CAAC5B,OAAlB,EAAxB,IAAuD,IAA1D,GAAiE,IAAzF;AACD,CAhBM;;;;AAkBA,MAAMyC,cAAc,GAAG,OAAO;AAACtB,EAAAA,MAAD;AAASC,EAAAA,OAAT;AAAkBsB,EAAAA;AAAlB,CAAP,EAAkC3C,CAAlC,KAAwC;AACpE,QAAMe,GAAG,GAAI,SAAQf,CAAC,CAAC4C,IAAF,CAAO7B,GAAI,EAAhC;AACA4B,EAAAA,MAAM,CAACE,IAAP,CAAY,qBAAqB9B,GAAjC;AACA,QAAMK,MAAM,CAAC0B,GAAP,CAAWC,SAAX,CAAqB,EAAE,GAAG1B,OAAO,CAACM,IAAb;AAAmBZ,IAAAA;AAAnB,GAArB,CAAN;AACD,CAJM","sourcesContent":["export const nowPlusSecs = secs => {\r\n  const date = new Date();\r\n  date.setSeconds(date.getSeconds() + secs);\r\n  return date.toDateString() + ' ' + date.toTimeString();\r\n};\r\n\r\nexport const updatedInTheLastSecs = (p, secs) =>\r\n  (new Date().getTime() - new Date(p.updated_at).getTime()) / 1000 < secs;\r\n\r\nexport const hasLabel = (p, label) => label === '*' || p.labels.filter(l => l.name === label).length > 0;\r\n\r\nexport const describePr = pr => `PR #${pr.number} '${pr.title}'`;\r\n\r\nexport const branchNameFromRef = ref => ref.toLowerCase().split(/\\//g).slice(-1)[0];\r\n\r\nexport const getLatestClosingCommentAgeSecs = async ({ client, context, args }, issueNumber) => {\r\n  const comments = await client.issues.listComments({\r\n    ...context.repo,\r\n    issue_number: issueNumber,\r\n  });\r\n  const latestCommentDate = comments.data\r\n    .filter(c => c.body.indexOf(args.closingSoonComment.replace(/\\@.*/, '')) === 0)\r\n    .reduce((latest, i) => {\r\n      const created = new Date(i.created_at);\r\n      if (!latest || created > latest) {\r\n        return created;\r\n      }\r\n      return latest;\r\n    }, undefined);\r\n\r\n  return latestCommentDate ? (new Date().getTime() - latestCommentDate.getTime()) / 1000 : null;\r\n};\r\n\r\nexport const deletePrBranch = async ({client, context, logger}, p) => {\r\n  const ref = `heads/${p.head.ref}`;\r\n  logger.info('Deleting branch ' + ref);\r\n  await client.git.deleteRef({ ...context.repo, ref });\r\n}"],"file":"common.js"}